<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Management</title>

    <style>
            body{
                font-family:Georgia, 'Times New Roman', Times, serif;
                background: #d3dbe7;
                margin:0;
                padding: 0;
            }

            header{
                background: #75c7e5;
                padding: 20px;
                text-align: center;
                color:#245a6d;
                font-size: 24px;
                font-weight: bold;
                margin-top:1%;
            }

            .welcome {
                font-size:15px;
                color:#2a6ac7;
                background: white;
                padding: 10px;
                border-radius: 30px;
                text-align: center;
                width: 40%;
                margin: 20px;
                border-color: #2a6ac7;

            }
            .container {
                display: flex;
                justify-content: center;
                gap: 5px;             
                margin-top: 20px;
                align-items: flex-start;

            }
    </style>
</head>
<body>
    <a href="http://localhost:3000/dashboard">Back to Dashboard</a>
    <header>Doctor Management</header>

<div class="container">

    <!-- Add a Doctor -->
    <form class="welcome" action="/add_doctor" method="post" novalidate>
        <h2>Add Doctor</h2>

        <label for="first_name">First Name:</label><br>
        <input type="text" id="first_name" name="first_name" ><br><br>

        <label for="last_name">Last Name:</label><br>
        <input type="text" id="last_name" name="last_name" ><br><br>

        <label for="specialty">Specialty:</label><br>
        <input type="text" id="specialty" name="specialty" ><br><br>

        <label for="department">Department:</label><br>
        <input type="text" id="department" name="department"><br><br>

        <label for="license_number">License Number:</label><br>
        <input type="text" id="license_number" name="license_number" required><br><br>

        <label for="phone_number">Phone Number:</label><br>
        <input type="text" id="phone_number" name="phone_number"><br><br>

        <label for="email">Email:</label><br>
        <input type="text" id="email" name="email"><br><br>

        <label for="office_number">Office Number:</label><br>
        <input type="text" id="office_number" name="office_number"><br><br>

        <label for="current_doctor">Currently Employed:</label>
        <select id="current_doctor" name="current_doctor">
            <option value="1">Yes</option>
            <option value="0">No</option>
        </select><br><br>

        <button type="submit">Add Doctor</button>
    </form>

    <!-- Delete a Doctor -->
    <form class="welcome" action="/delete_doctor" method="post" novalidate>
        <h2>Delete Doctor</h2>

        <label for="doctor_id">Enter Doctor ID to Delete:</label><br>
        <input type="number" id="doctor_id" name="doctor_id" required><br><br>

        <button type="submit">Delete Doctor</button>
    </form>

</div>
    <!-- All Doctors Table -->
    <h2>All Doctors</h2>
    <table border="1" cellpadding="6">
        <thead>
            <tr>
                <th>ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Specialty</th>
                <th>Department</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Office #</th>
                <th>Active</th>
            </tr>
        </thead>
        <tbody id="doctorTable"></tbody>
    </table>

    <!-- Fetch All Doctors -->
    <script>
        fetch('/doctors')
            .then(response => response.json())
            .then(data => {
                const table = document.getElementById("doctorTable");
                table.innerHTML = "";

                data.forEach(d => {
                    const row = table.insertRow();
                    row.insertCell(0).innerText = d.doctor_id;
                    row.insertCell(1).innerText = d.first_name;
                    row.insertCell(2).innerText = d.last_name;
                    row.insertCell(3).innerText = d.specialty;
                    row.insertCell(4).innerText = d.department || "";
                    row.insertCell(5).innerText = d.phone_number || "";
                    row.insertCell(6).innerText = d.email || "";
                    row.insertCell(7).innerText = d.office_number || "";
                    row.insertCell(8).innerText = d.current_doctor ? "Yes" : "No";
                });
            })
            .catch(err => console.error("Error loading doctors:", err));
    </script>
    <script>
        document.querySelector('form[action="/add_doctor"]').addEventListener("submit", function (e) {

        const firstName = document.getElementById("first_name");
        const lastName = document.getElementById("last_name");
        const specialty = document.getElementById("specialty");
        const licenseNum = document.getElementById("license_number");
        const phone = document.getElementById("phone_number");
        const email = document.getElementById("email");

        const first = firstName.value.trim();
        const last = lastName.value.trim();
        const special = specialty.value.trim();
        const license = licenseNum.value.trim();
        const phoneVal = phone.value.trim();
        const emailVal = email.value.trim();
        
        //Does not allow error messages to stack
        document.querySelectorAll(".error").forEach(err => err.remove());

        let isValid = true;

        //first name validation
        if (first == "") {
            showError (firstName, "First name is required");
            isValid = false;
        }

        //last name validation
        if (last == "") {
            showError (lastName, "Last name is required");
            isValid = false;
        }

        //Speciality Validation
        if (special == "") {
            showError (specialty, "Specialty is required");
            isValid = false;
        }


        //License Number Validation
        const licensePattern = /^LIC\d{5}$/;
        if (license === "") {
            showError(licenseNum, "License number is required.");
            isValid = false;
        } else if (!licensePattern.test(license)) {
            showError(licenseNum, "License number must be in format LIC + 5 digits.");
            isValid = false;
        }
        
        //Phone number validation
        const phonePattern = /^\d{3}-\d{3}-\d{4}$/;
         if (phoneVal !== "" && !phonePattern.test(phoneVal)) {
            showError (phone, "Phone must be in format 123-456-7890");
            isValid = false;
        }
        
        //Email must end in @medportal.com
        if (emailVal !== "" && !emailVal.endsWith("@medportal.com")) {
            showError(email, "Email must end with @medportal.com.");
            isValid = false;
        }

        // Block form submission if invalid
        if (!isValid) {
            e.preventDefault();
        }
    });

    document.querySelector('form[action="/delete_doctor"]').addEventListener("submit", function (e) {

        const id = document.getElementById("doctor_id");
        const idVal = id.value.trim();

        //Does not allow error messages to stack
        document.querySelectorAll(".error").forEach(err => err.remove());

        let isValid = true;

        //Doctor ID validation
        if (idVal === "") {
            showError(id, "Doctor ID is required.");
            isValid = false;
        } else if (isNaN(idVal)) {
            showError(id, "Doctor ID must be a number.");
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
        }
    });
    // Shows errors message
    function showError(field, message) {
        const error = document.createElement("div");
        error.className = "error";
        error.style.color = "red";
        error.style.marginTop = "6px";
        error.style.fontSize = "14px";
        error.textContent = message;
        field.insertAdjacentElement("afterend", error);
        }
    </script>

</body>
</html>
