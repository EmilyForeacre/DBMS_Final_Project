<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patients Management</title>
    </head>
    <body>
        <a href="http://localhost:3000/dashboard">Back to Dashboard</a>
        <h1>Patient Management</h1>

        <!-- Add Patient Form -->
    <h2>Add Patient</h2>
    <form action="/add_patient" method="post" novalidate>

        <label for="first_name">First Name:</label><br>
        <input type="text" id="first_name" name="first_name"><br><br>

        <label for="last_name">Last Name:</label><br>
        <input type="text" id="last_name" name="last_name"><br><br>

        <label for="date_of_birth">Date of Birth:</label><br>
        <input type="date" id="date_of_birth" name="date_of_birth" ><br><br>

        <label for="gender">Gender:</label><br>
        <select id="gender" name="gender">
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
        </select><br><br>

        <label for="phone_number">Phone Number:</label><br>
        <input type="text" id="phone_number" name="phone_number"><br><br>

        <label for="email">Email:</label><br>
       <input type="text" id="email" name="email"><br><br>

        <label for="address">Address:</label><br>
        <input type="text" id="address" name="address"><br><br>

        <label for="state">State:</label><br>
        <input type="text" id="state" name="state" maxlength="2"><br><br>

        <label for="city">City:</label><br>
        <input type="text" id="city" name="city"><br><br>

        <label for="zip_code">Zip Code:</label><br>
        <input type="text" id="zip_code" name="zip_code"><br><br>

        <label for="insurance_provider">Insurance Provider:</label><br>
        <input type="text" id="insurance_provider" name="insurance_provider"><br><br>

        <label for="current_patient">Current Patient:</label>
        <select id="current_patient" name="current_patient">
            <option value="1">Yes</option>
            <option value="0">No</option>
        </select><br><br>

        <button type="submit">Add Patient</button>
    </form>

    <!-- Delete Patient Form -->
    <h2>Delete Patient</h2>
    <form action="/delete_patient" method="post" novalidate>
        <label for="patient_id">Enter Patient ID to Delete:</label><br>
        <input type="text" id="patient_id" name="patient_id" ><br><br>

        <button type="submit">Delete Patient</button>
    </form>

    <!-- All Patients Table -->
    <h2>All Patients</h2>
    <table border="1" cellpadding="6">
        <thead>
            <tr>
                <th>Patient ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>DOB</th>
                <th>Gender</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Address</th>
                <th>State</th>
                <th>City</th>
                <th>Zip Code</th>
                <th>Insurance Provider</th>
                <th>Current Patient</th>
            </tr>
        </thead>
        <tbody id="patientTable"></tbody>
    </table>

    <!-- Fetch Patients -->
    <script>
        fetch('/patients')
            .then(response => response.json())
            .then(data => {
                const table = document.getElementById("patientTable");
                table.innerHTML = "";

                data.forEach(p => {
                    const row = table.insertRow();
                    row.insertCell(0).innerText = p.patient_id;
                    row.insertCell(1).innerText = p.first_name;
                    row.insertCell(2).innerText = p.last_name;
                    row.insertCell(3).innerText = p.date_of_birth;
                    row.insertCell(4).innerText = p.gender;
                    row.insertCell(5).innerText = p.phone_number || "";
                    row.insertCell(6).innerText = p.email || "";
                    row.insertCell(7).innerText = p.address  || "";
                    row.insertCell(8).innerText = p.state || "";
                    row.insertCell(9).innerText = p.city || "";
                    row.insertCell(10).innerText = p.zip_code || "";
                    row.insertCell(11).innerText = p.insurance_provider || "";
                    row.insertCell(12).innerText = p.current_patient ? "Yes" : "No";
                });
            })
            .catch(err => console.error("Error loading patients:", err));
            
    </script>
    <script>
        document.querySelector('form[action="/add_patient"]').addEventListener("submit", function (e) {

        const firstName = document.getElementById("first_name");
        const lastName = document.getElementById("last_name");
        const dob = document.getElementById("date_of_birth");
        const phone = document.getElementById("phone_number");
        const email = document.getElementById("email");
        const state = document.getElementById("state");
        const zip = document.getElementById("zip_code");

        const first = firstName.value.trim();
        const last = lastName.value.trim();
        const birth = dob.value.trim();
        const phoneVal = phone.value.trim();
        const emailVal = email.value.trim();
        const stateVal = state.value.trim();
        const zipVal = zip.value.trim();


        //Does not allow error messages to stack
        document.querySelectorAll(".error").forEach(err => err.remove());

        let isValid = true;

        //first name validation
        if (first == "") {
            showError (firstName, "Firstname is required");
            isValid = false;
        }

        //last name validation
        if (last == "") {
            showError (lastName, "Lastname is required");
            isValid = false;
        }

        //dob validation
        if (birth == "") {
            showError (dob, "DOB is required");
            isValid = false;
        }

        //Phone number validation (xxx-xxx-xxxx)
        const phonePattern = /^\d{3}-\d{3}-\d{4}$/;
         if (phoneVal !== "" && !phonePattern.test(phoneVal)) {
            showError (phone, "Phone must be in format 123-456-7890");
            isValid = false;
        }

        //Email Validation 
        const emailPattern = /^[^\s@]+@[^\s@]+\.com$/;
        if (emailVal !== "" && !emailPattern.test(emailVal)) {
            showError (email, "Inncorrect email format");
            isValid = false;
        }

        //State validation (2 letters)
        const statePattern = /^[A-Za-z]{2}$/;
        if (stateVal !== "" && !statePattern.test(stateVal)) {
            showError(state, "State must be 2 letters.");
            isValid = false;
        }

        //Zip code validation (5 digits)
        const zipPattern = /^\d{5}$/;
        if (zipVal !== "" && !zipPattern.test(zipVal)) {
            showError(zip, "Zip code must be 5 digits.");
            isValid = false;
        }

        // Block form submission if invalid
        if (!isValid) {
            e.preventDefault();
        }
    });

        document.querySelector('form[action="/delete_patient"]').addEventListener("submit", function (e) {

        const id = document.getElementById("patient_id");
        const idVal = id.value.trim();

        //Does not allow error messages to stack
        document.querySelectorAll(".error").forEach(err => err.remove());

        let isValid = true;

        //Patient ID validation
        if (idVal === "") {
            showError(id, "Patient ID is required.");
            isValid = false;
        } else if (isNaN(idVal)) {
            showError(id, "Patient ID must be a number.");
            isValid = false;
    }

    if (!isValid) {
        e.preventDefault();
    }
});
// Shows errors message
function showError(field, message) {
    const error = document.createElement("div");
    error.className = "error";
    error.style.color = "red";
    error.style.marginTop = "6px";
    error.style.fontSize = "14px";
    error.textContent = message;
    field.insertAdjacentElement("afterend", error);
}



    </script>
</body>
</html>
